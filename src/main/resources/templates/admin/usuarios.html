<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Listado de Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <h2 class="mb-4 text-center">Gesti√≥n de Usuarios</h2>

    <!-- ‚úÖ Mensaje de √©xito -->
    <div th:if="${mensaje}" class="alert alert-success" role="alert" th:text="${mensaje}"></div>

    <!-- ‚ö†Ô∏è Advertencia si hay veh√≠culos -->
    <div th:if="${advertencia}" class="alert alert-warning">
        <p th:text="${advertencia}"></p>
        <form th:action="@{'/admin/usuarios/' + ${usuarioId} + '/eliminar'}" method="post">
            <input type="hidden" name="forzar" value="true"/>
            <button type="submit" class="btn btn-danger btn-sm mt-2">S√≠, eliminar usuario y todos sus veh√≠culos</button>
        </form>
    </div>

    <!-- üßæ Tabla de usuarios -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Email</th>
            <th>Nombre</th>
            <th>Fecha de alta</th>
            <th>Rol</th>
            <th>Estado</th>
            <th class="text-center">Acciones</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="usuario : ${usuarios}">
            <td th:text="${usuario.email}"></td>
            <td th:text="${usuario.nombreUsuario}">--</td>
            <td th:text="${#temporals.format(usuario.fechaAlta, 'dd/MM/yyyy')}">--</td>
            <td th:text="${usuario.rol}"></td>
            <td>
                <span th:text="${usuario.activo ? 'Activo' : 'Inactivo'}"
                      th:classappend="${usuario.activo} ? 'text-success' : 'text-danger'"></span>
            </td>
            <td class="text-center">
                <!-- Activar -->
                <form th:if="${!usuario.activo}"
                      th:action="@{'/admin/usuarios/' + ${usuario.id} + '/activar'}"
                      method="post"
                      style="display:inline;">
                    <button type="submit" class="btn btn-success btn-sm">Activar</button>
                </form>

                <!-- Desactivar -->
                <form th:if="${usuario.activo}"
                      th:action="@{'/admin/usuarios/' + ${usuario.id} + '/desactivar'}"
                      method="post"
                      style="display:inline;">
                    <button type="submit" class="btn btn-warning btn-sm">Desactivar</button>
                </form>

                <!-- Eliminar -->
                <form th:action="@{'/admin/usuarios/' + ${usuario.id} + '/eliminar'}"
                      method="post"
                      style="display:inline;"
                      onsubmit="return confirm('¬øEst√°s seguro que quer√©s eliminar este usuario?');">
                    <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
    <div class="mb-3">
        <a href="/admin/dashboard" class="btn btn-success">&larr; Volver al panel</a>
    </div>

</body>
</html>
